# Maintainer Guide: Auto-Discovery Workflow

This guide explains how to review and manage repositories discovered by the auto-discovery workflow.

## Overview

The auto-discovery workflow runs weekly (Sundays at 6 AM UTC) and searches GitHub for repositories that:
- Have a `.enhansome.jsonc` file in their root directory
- Set `"registryIndexing": true` in their configuration
- Have a `README.json` file generated by the Enhansome action

When a new repository is discovered, an issue is automatically created with the label `auto-discovery` and `needs-review`.

## Reviewing Auto-Discovery Issues

Each auto-discovery issue contains:
- Repository name and link
- Awesome list name and description
- Links to `README.json` and `.enhansome.jsonc` files
- Preview of the configuration

### Review Checklist

Before approving a repository, verify:

1. **Quality Check**
   - [ ] Repository has a legitimate awesome list
   - [ ] README.json is properly formatted
   - [ ] Content appears to be high-quality and relevant
   - [ ] Repository is actively maintained

2. **Security Check**
   - [ ] Repository owner is trustworthy
   - [ ] No malicious content or links
   - [ ] `source_repository` in README.json matches the actual repository

3. **Format Check**
   - [ ] `.enhansome.jsonc` has `"registryIndexing": true`
   - [ ] README.json exists and is valid JSON
   - [ ] Metadata fields are complete

## Approval Process

To approve and add a repository to the registry:

### Step 1: Review the Repository

Click through the links in the issue to inspect:
- The repository itself
- The `README.json` file
- The `.enhansome.jsonc` configuration

### Step 2: Add to Allowlist

If approved, add the repository to `allowlist.txt`:

```bash
# Clone or navigate to the repository
cd /path/to/enhansome-registry

# Add the repository to allowlist.txt
# Format: owner/repo/README.json
echo "owner/repo/README.json" >> allowlist.txt

# Example:
echo "awesome-user/awesome-golang/README.json" >> allowlist.txt
```

### Step 3: Commit and Push

```bash
git add allowlist.txt
git commit -m "feat: Add awesome-user/awesome-golang to registry

Approved from auto-discovery issue #123"
git push
```

### Step 4: Close the Issue

After pushing the changes:
1. Go to the auto-discovery issue
2. Add a comment: "✅ Approved and added to registry"
3. Close the issue

## Rejection Process

To reject a repository and prevent future discovery:

### Step 1: Add to Denylist

```bash
# Add the repository to denylist.txt
# Format: owner/repo (without README.json)
echo "owner/repo" >> denylist.txt

# Example:
echo "spam-user/fake-list" >> denylist.txt
```

### Step 2: Commit and Push

```bash
git add denylist.txt
git commit -m "chore: Add spam-user/fake-list to denylist

Rejected from auto-discovery issue #123"
git push
```

### Step 3: Close the Issue

1. Go to the auto-discovery issue
2. Add a comment explaining why it was rejected (optional but recommended)
3. Add label: `rejected`
4. Close the issue

## Defer/Postpone Decision

If you need more time to decide:

1. **Option 1: Leave Issue Open**
   - Simply leave the issue open
   - The workflow will skip it in future runs
   - Review when you have time

2. **Option 2: Close Without Action**
   - Close the issue without adding to allowlist or denylist
   - Add label: `deferred`
   - The repository will be re-discovered in the next run

## Quick Reference Commands

### Approve Repository
```bash
# Add to allowlist
echo "owner/repo/README.json" >> allowlist.txt
git add allowlist.txt
git commit -m "feat: Add owner/repo to registry"
git push
```

### Reject Repository
```bash
# Add to denylist
echo "owner/repo" >> denylist.txt
git add denylist.txt
git commit -m "chore: Add owner/repo to denylist"
git push
```

### Batch Processing
```bash
# Approve multiple repositories
cat >> allowlist.txt <<EOF
user1/repo1/README.json
user2/repo2/README.json
user3/repo3/README.json
EOF

git add allowlist.txt
git commit -m "feat: Add multiple repositories to registry"
git push
```

## Workflow Details

### Schedule
- **Automatic:** Every Sunday at 6:00 AM UTC
- **Manual:** Can be triggered via "Actions" tab → "Auto-Discover Enhansome Repositories" → "Run workflow"

### What Gets Skipped
The workflow automatically skips:
- Repositories already in `allowlist.txt`
- Repositories in `denylist.txt`
- Repositories with existing open auto-discovery issues
- Repositories without a valid `README.json` file

### Labels
- `auto-discovery`: All issues created by the workflow
- `needs-review`: New issues requiring maintainer review
- `rejected`: Issues that were rejected (optional, for record-keeping)
- `deferred`: Issues postponed for later review (optional)

## Troubleshooting

### Issue Created But README.json Doesn't Exist
This shouldn't happen as the workflow verifies README.json exists. If it does:
1. Check if the repository changed after discovery
2. Reject and add to denylist
3. Report as a bug in the workflow

### Duplicate Issues Created
The workflow checks for existing open issues. If duplicates occur:
1. Close the duplicate
2. Check workflow logs for errors
3. Consider if the issue was closed and reopened

### Repository Shows Different Content
If the repository content doesn't match what's shown in the issue:
1. The repository may have changed after discovery
2. Review the current state before approving
3. If malicious, add to denylist immediately

### Can't Push to Repository
Ensure you have:
- Write access to the repository
- Proper git credentials configured
- No merge conflicts in allowlist.txt or denylist.txt

## Best Practices

1. **Review Promptly**: Try to review auto-discovery issues within a week
2. **Be Conservative**: When in doubt, defer rather than approve immediately
3. **Document Rejections**: Add a comment explaining why a repository was rejected
4. **Check Regularly**: Monitor the "Actions" tab for workflow failures
5. **Keep Lists Clean**: Periodically review allowlist.txt and denylist.txt for outdated entries

## Integration with Daily Indexer

Once a repository is added to `allowlist.txt`:
1. The daily indexer workflow will pick it up automatically
2. It runs daily at 5:00 AM UTC (one hour before auto-discovery)
3. The data is fetched, validated, and committed to `/data` directory
4. No additional action is needed

The format must be:
```
owner/repo/README.json
```

NOT:
```
owner/repo          ❌ Missing filename
owner/repo/         ❌ Missing filename
README.json         ❌ Missing owner/repo
```

## Getting Help

- **Documentation Issues**: Update this file or README.md
- **Workflow Bugs**: Check `.github/workflows/auto-discover.yaml`
- **Questions**: Open a discussion in the repository
